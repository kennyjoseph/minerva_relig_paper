scale_fill_gradientn(colours=c("red","white","steelblue"),
rescaler = function(x, ...) x,
values=c(min(by_date[type=="TWITTER"]$V1-.1),
0,max(by_date[type=="TWITTER"]$V1)+.1),
oob = identity,name="value"),
width=8,height=5.5)
ggsave("../arab_spring_paper/imgs/activity_date_news.pdf",p2,
width=8,height=7)
ggsave("../arab_spring_paper/imgs/activity_date_twitter.pdf",
p2 %+% by_date[type=="TWITTER" ] +
scale_fill_gradientn(colours=c("red","white","steelblue"),
rescaler = function(x, ...) x,
values=c(min(by_date[type=="TWITTER"]$V1-.1),
0,max(by_date[type=="TWITTER"]$V1)+.1),
oob = identity,name="value"),
width=8,height=7)
c <- "War"
fd
p1 <- ggplot(by_cat[category=="War"],
aes(type,category,fill=V1))
p1 <- p1 + geom_tile() + facet_wrap(~type)
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 <- p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1
p1 <- ggplot(by_cat[category=="War"],
aes(type,date,fill=V1))
p1 <- p1 + geom_tile() + facet_wrap(~type)
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 <- p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1
by_cat[category=="War"]
p1 <- ggplot(eta_res[category=="War"],
aes(type,date,fill=V1))
p1 <- p1 + geom_tile() + facet_wrap(~type)
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 <- p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1
eta_res[category=="War"]
p1 <- ggplot(eta_res[category=="War"],
aes(type,date,fill=value))
p1 <- p1 + geom_tile() + facet_wrap(~country)
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1 <- ggplot(eta_res[category=="War"],
aes(country,date,fill=value))
p1 <- p1 + geom_tile() + facet_wrap(~type)
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1 <- ggplot(eta_res[category=="War"],
aes(country,date,fill=value))
p1 <- p1 + geom_tile() + facet_wrap(~type)
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 <- p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1 <- p1 + scale_fill_gradientn(
colours=c("red","white","steelblue"))
p1
pdf("~/Desktop/blah.pdf", onefile = TRUE,width=15,height=12)
for(c in unique(eta_res$category)){
p1 <- ggplot(eta_res[category=="War"],
aes(country,date,fill=value))
p1 <- p1 + geom_tile() + facet_wrap(~type)
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 <- p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1 <- p1 + scale_fill_gradientn(
colours=c("red","white","steelblue"))
print(p1)
}
dev.off()
p1 +theme(title="War")
p1 +ggtitle("War")
pdf("~/Desktop/blah.pdf", onefile = TRUE,width=15,height=12)
for(c in unique(eta_res$category)){
p1 <- ggplot(eta_res[category=="War"],
aes(country,date,fill=value))
p1 <- p1 + geom_tile() + facet_wrap(~type)
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 <- p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1 <- p1 + scale_fill_gradientn(
colours=c("red","white","steelblue"))
print(p1+ggtitle(c))
}
dev.off()
pdf("~/Desktop/blah.pdf", onefile = TRUE,width=15,height=12)
for(c in unique(eta_res$category)){
p1 <- ggplot(eta_res[category==c],
aes(country,date,fill=value))
p1 <- p1 + geom_tile() + facet_wrap(~type)
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 <- p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1 <- p1 + scale_fill_gradientn(
colours=c("red","white","steelblue"))
print(p1+ggtitle(c))
}
dev.off()
load("result_data/full_news_data_all.rdata")
news_df
news_df[country=='bahrain']
table(news_df[country=='bahrain']$category)
table(news_df[country=='uae']$category)
table(news_df[country=='uae']$country)
table(news_df$country)
table(news_df$country)/nrow(news_df)
pdf("~/Desktop/blah2.pdf", onefile = TRUE,width=15,height=12)
for(c in unique(eta_res$category)){
print(ggplot(fd[fd$country  == c, ], aes(date, value,color=variable))  + facet_wrap(type~category) + theme(axis.text.x=element_text(angle=45,hjust=1)) + stat_smooth(size=2,se=F) + geom_point(size=2.5)  + geom_hline(y=0) + ggtitle(c)+ scale_x_datetime(breaks="3 months"))
}
dev.off()
p1 <- ggplot(eta_res[category==c],
aes(date,value))
p1 <- p1 + geom_point() + facet_wrap(~country) + geom_smooth()
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 <- p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1 <- p1 + scale_fill_gradientn(
colours=c("red","white","steelblue"))
print(p1+ggtitle(c))
p1 <- ggplot(eta_res[category==c],
aes(date,value))
p1 <- p1 + geom_point() + facet_wrap(~country) + geom_smooth()
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
print(p1+ggtitle(c))
pdf("~/Desktop/blah2.pdf", onefile = TRUE,width=15,height=12)
for(c in unique(eta_res$category)){
p1 <- ggplot(eta_res[category==c],
aes(date,value,color=type))
p1 <- p1 + geom_point() + facet_wrap(~country) + geom_smooth()
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
print(p1+ggtitle(c))
}
dev.off()
eta_res <- eta_res[category != "Professions"]
news <- spread(eta_res[!(category %in% c("Stopwords 1","Stopwords 2","Stopwords 3")) & type=="NEWS",mean(value),by=c("type","country","category")],category,V1)
twitter <- spread(eta_res[!(category %in% c("Stopwords 1","Stopwords 2","Stopwords 3")) & type=="TWITTER",mean(value),by=c("type","country","category")],category,V1)
comb <- merge(news,twitter,by="country")
comb$type.x <- NULL
comb$type.y <- NULL
dist_mat <-as.matrix(comb[,2:ncol(comb),with=F])
row.names(dist_mat) <- comb$country
source("http://addictedtor.free.fr/packages/A2R/lastVersion/R/code.R")
hc <- hclust(dist(dist_mat))
p2 <- ggdendrogram(hc)
library(ggdendro)
p2
p2 <- ggdendrogram(hc)
p2
dist_mat
ggsave("../arab_spring_paper/imgs/country_dendro.pdf",p2,width=6,height=4)
### Confirm sigma for news vs twitter
p3 <- ggplot(unique(eta_res[,c("type","country","category","sigma"),with=F]), aes(sigma,fill=type)) + geom_density(alpha=.6) + xlab(expression(sigma^2)) + ylab("density") + guides(fill = guide_legend(title="Medium",override.aes = list(colour = NULL)))
ggsave("../arab_spring_paper/imgs/diff_sigma.pdf",p3,width=8,height=3.5)
p3
lagged_vals <- eta_res[,list(date=arrange(.SD,date)$date[2:nrow(.SD)], value=diff(arrange(.SD,date)$value),sigma=sigma[2:nrow(.SD)]),by=c("category","country","type"),]
##take a look at the correlations.
lv <- lagged_vals
lv$sigma <- NULL
spread(lv,type,value)
lv <- spread(lv,type,value)
lv$cat_is_stop <- with(lv,category=="Stopwords 1"|
category=="Stopwords 2"|
category=="Stopwords 3")
ggplot(lv, aes(NEWS,TWITTER)) + geom_point() + facet_wrap(~cat_is_stop)
library(boot)
f <- function(d, i){
return(cor(d[i,]$TWITTER, d[i,]$NEWS))
}
boot_approx <- function(data,times_to_run=10000){
boot_out <- boot(data, f, R=times_to_run)
return(c(boot_out$t0,boot.ci(boot_out,type="basic",conf=.99)$basic[4:5]))
}
boot_approx(lv[cat_is_stop == F])
##some stop word correlation but pretty slight
boot_approx(lv[cat_is_stop==T ])
d2
lv$corr_cat <- lv$category
lv[cat_is_stop == T]$corr_cat <- "stop"
d2 <- lv[,as.list(boot_approx(.SD)),by="corr_cat"]
d2[corr_cat =="stop"]$corr_cat <- "All Stopword Categories"
p4 <- ggplot(d2, aes(reorder(corr_cat,-V1),V1, ymin=V2,ymax=V3,color=corr_cat!="All Stopword Categories" )) + geom_pointrange(size=1.5) + coord_flip() + geom_hline(y=0,color='red') + ylab("Correlation") + xlab("Category") + theme(legend.position="none")
ggsave("../arab_spring_paper/imgs/cat_corr.pdf",p4,width=8,height=3.5)
p4
eta_res <- results[,as.list(apply(eta_samples_list[[paste(type,country,category,sep="_")]],1,mean)),by=c("type","country","category","a","sigma","iter")]
load("all_stuff.rdata")
load("result_data/news_data.rdata")
time_df <- data.frame(variable=paste0("V",1:23),
date=sort(ALL_NEWS_TIMES[ALL_NEWS_TIMES %in% ALL_TIMES]))
eta_res <- melt(eta_res, id.vars=c("type","country","category","a","sigma"))
eta_res <- merge(eta_res, time_df,by="variable")
eta_res$variable <- NULL
eta_res <- data.table(eta_res )
#not enough Twitter data for political, morocco/oman/algeria
eta_res <- eta_res[category != "political"]
eta_res <- eta_res[! country %in% c("morocco","oman","algeria")]
eta_res$country <- factor(eta_res$country,
levels=c("tunisia","egypt","libya","yemen","syria",
"bahrain","jordan","lebanon",
"saudi_arabia","kuwait","uae",
"iran","iraq"),
labels=c("Tunisia","Egypt","Libya","Yemen","Syria",
"Bahrain",
"Jordan","Lebanon",
"Saudi Arabia","Kuwait","UAE",
"Iran","Iraq"))
eta_res$category <- factor(eta_res$category,
levels=c("adaptation","youth","profession",
"nationality","tribe","terrorist_org",
"protest","violence","war","stop4",
"stop5","stop6"),
labels=c("Adaptation","Youth","Professions",
"Nationalities","Ethnic Groups",
"Terrorist Orgs",
"Protest","Violence","War","Stopwords 1",
"Stopwords 2","Stopwords 3"))
eta_res <- eta_res[category != "Professions"]
eta_res
pdf("~/Desktop/blah2.pdf", onefile = TRUE,width=15,height=12)
for(c in unique(eta_res$category)){
print(ggplot(fd[fd$country  == c, ], aes(date, value,color=variable))  + facet_wrap(type~category) + theme(axis.text.x=element_text(angle=45,hjust=1)) + stat_smooth(size=2,se=F) + geom_point(size=2.5)  + geom_hline(y=0) + ggtitle(c)+ scale_x_datetime(breaks="3 months"))
}
dev.off()
pdf("~/Desktop/blah.pdf", onefile = TRUE,width=15,height=12)
for(c in unique(eta_res$category)){
p1 <- ggplot(eta_res[category==c],
aes(country,date,fill=value))
p1 <- p1 + geom_tile() + facet_wrap(~type)
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 <- p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1 <- p1 + scale_fill_gradientn(
colours=c("red","white","steelblue"))
print(p1+ggtitle(c))
}
dev.off()
eta_res
ggplot(eta_res[category %in% c("Ethnic Groups","Nationalities")], aes(date, value, color=category)) + facet_wrap(~country)
ggplot(eta_res[category %in% c("Ethnic Groups","Nationalities") & type=="NEWS"], aes(date, value, color=category)) + facet_wrap(~country) + geom_point() + stat_smooth()
nat_v_eth <- eta_res[category %in% c("Ethnic Groups","Nationalities")]
not_V
not_v
nat_v_eth
nat_v_eth[,nrow(.SD),by=c("type","country")]
nat_v_eth[,nrow(.SD),by=c("type","country","date")]
nat_v_eth[,.SD[category=="Nationalities"]$value-.SD[category=="Ethnic Groups"]$value,by=c("type","country","date")]
diff_eth <- nat_v_eth[,.SD[category=="Nationalities"]$value-.SD[category=="Ethnic Groups"]$value,by=c("type","country","date")]
ggplot(diff_eth, aes(date,V1,color=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country)
ggplot(diff_eth[country != "UAE"], aes(date,V1,color=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country)
ggplot(diff_eth[country != "UAE"], aes(date,V1,color=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45))
ggplot(diff_eth[country != "UAE"], aes(date,V1,color=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1))
ggplot(diff_eth[country != "UAE"], aes(date,V1,color=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + stat_smooth()
ggplot(diff_eth[country != "UAE"&type=="NEWS"], aes(date,V1,color=country)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1))
ggplot(diff_eth[country != "UAE"&type=="NEWS"], aes(date,V1,color=country)) + geom_line() + geom_point() + geom_hline(y=0)  + theme(axis.text.x=element_text(angle=45,hjust=1))
ggplot(diff_eth[country != "UAE"&type=="NEWS"], aes(date,V1,color=country)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1))
ggplot(diff_eth[country != "UAE"&type=="NEWS"], aes(date,V1,color=country)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth()
eta_res$country <- factor(eta_res$country, levels=c("Tunisia","Egypt","Libya","Yemen","Syria",
"Jordan","Lebanon", "Bahrain",
"Saudi Arabia","Kuwait","UAE",
"Iran","Iraq")))
eta_res$country <- factor(eta_res$country, levels=c("Tunisia","Egypt","Libya","Yemen","Syria",
"Jordan","Lebanon", "Bahrain",
"Saudi Arabia","Kuwait","UAE",
"Iran","Iraq"))
ggplot(diff_eth[country != "UAE"&type=="NEWS"], aes(date,V1,color=country)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth()
nat_v_eth <- eta_res[category %in% c("Ethnic Groups","Nationalities")]
diff_eth <- nat_v_eth[,.SD[category=="Nationalities"]$value-.SD[category=="Ethnic Groups"]$value,by=c("type","country","date")]
ggplot(diff_eth[country != "UAE"&type=="NEWS"], aes(date,V1,color=country)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth()
nat_v_eth <- eta_res[category %in% c("Ethnic Groups","Nationalities")]
diff_eth <- nat_v_eth[,.SD[category=="Nationalities"]$value-.SD[category=="Ethnic Groups"]$value,by=c("type","country","date")]
ggplot(diff_eth[country != "UAE"&type=="TWITTER"], aes(date,V1,color=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth()
nat_v_eth <- eta_res[category %in% c("Ethnic Groups","Nationalities")]
diff_eth <- nat_v_eth[,.SD[category=="Nationalities"]$value-.SD[category=="Ethnic Groups"]$value,by=c("type","country","date")]
ggplot(diff_eth[country != "UAE"], aes(date,V1,color=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth()
nat_v_eth <- eta_res[category %in% c("Ethnic Groups","Nationalities")]
diff_eth <- nat_v_eth[,.SD[category=="Nationalities"]$value-.SD[category=="Ethnic Groups"]$value,by=c("type","country","date")]
ggplot(diff_eth[country != "UAE"], aes(date,V1,color=type,fill=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth()
nat_v_eth <- eta_res[category %in% c("Ethnic Groups","Nationalities")]
diff_eth <- nat_v_eth[,.SD[category=="Nationalities"]$value-.SD[category=="Ethnic Groups"]$value,by=c("type","country","date")]
ggplot(diff_eth, aes(date,V1,color=type,fill=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth()
pdf("~/Desktop/blah.pdf", onefile = TRUE,width=15,height=12)
for(c in unique(eta_res$category)){
p1 <- ggplot(eta_res[category==c],
aes(country,date,fill=value))
p1 <- p1 + geom_tile() + facet_wrap(~type)
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 <- p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1 <- p1 + scale_fill_gradientn(
colours=c("red","white","steelblue"))
print(p1+ggtitle(c))
}
dev.off()
install.packages("PTAk")
library(PTAk)
install.packages("maptools")
library(maptools)
data("Zone_climTUN")
Zone_climTUN
dim (Zone_climTUN)
plot(Zone_climTUN, ol = NA, auxvar = Zone_climTUN$att.data$PREC_OCTO, nclass = 20)
library(maptools)
plot(Zone_climTUN, ol = NA, auxvar = Zone_climTUN$att.data$PREC_OCTO, nclass = 20)
eta_vals
eta_val
eta_res
eta_res[type=="NEWS"]
?simplify2array
split(eta_res[type=="NEWS"], eta_res$country)
pdf("~/Desktop/blah.pdf", onefile = TRUE,width=15,height=12)
for(c in unique(eta_res$category)){
p1 <- ggplot(eta_res[category==c & country %in% c("Egypt","Libya","Syria","Yemen","Bahrain","Saudi Arabia")],
aes(country,date,fill=value))
p1 <- p1 + geom_tile() + facet_wrap(~type)
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 <- p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1 <- p1 + scale_fill_gradientn(
colours=c("red","white","steelblue"))
print(p1+ggtitle(c))
}
dev.off()split(eta_res[type=="NEWS"], eta_res$country)
dev.off()
pdf("~/Desktop/blah.pdf", onefile = TRUE,width=15,height=12)
for(c in unique(eta_res$category)){
if(c %in% c("Stopwords 1","Stopwords 2","Stopwords 3")){
continue
}
p1 <- ggplot(eta_res[category==c & country %in% c("Egypt","Libya","Syria","Yemen","Bahrain","Saudi Arabia")],
aes(country,date,fill=value))
p1 <- p1 + geom_tile() + facet_wrap(~type)
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 <- p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1 <- p1 + scale_fill_gradientn(
colours=c("red","white","steelblue"))
print(p1+ggtitle(c))
}
dev.off()
for(c in unique(eta_res$category)){
if(c %in% c("Stopwords 1","Stopwords 2","Stopwords 3")){
next
}
p1 <- ggplot(eta_res[category==c & country %in% c("Egypt","Libya","Syria","Yemen","Bahrain","Saudi Arabia")],
aes(country,date,fill=value))
p1 <- p1 + geom_tile() + facet_wrap(~type)
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 <- p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1 <- p1 + scale_fill_gradientn(
colours=c("red","white","steelblue"))
print(p1+ggtitle(c))
}
dev.off()
pdf("~/Desktop/blah.pdf", onefile = TRUE,width=15,height=12)
for(c in unique(eta_res$category)){
if(c %in% c("Stopwords 1","Stopwords 2","Stopwords 3")){
} else {
p1 <- ggplot(eta_res[category==c & country %in% c("Egypt","Libya","Syria","Yemen","Bahrain","Saudi Arabia")],
aes(country,date,fill=value))
p1 <- p1 + geom_tile() + facet_wrap(~type)
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 <- p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1 <- p1 + scale_fill_gradientn(
colours=c("red","white","steelblue"))
print(p1+ggtitle(c))
}
}
dev.off()
nat_v_eth <- eta_res[category %in% c("Ethnic Groups","Nationalities") & country %in% c("Egypt","Libya","Syria","Yemen","Bahrain","Saudi Arabia")]
diff_eth <- nat_v_eth[,.SD[category=="Nationalities"]$value-.SD[category=="Ethnic Groups"]$value,by=c("type","country","date")]
ggplot(diff_eth[country != "UAE"&type=="NEWS"], aes(date,V1,color=country)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth()
ggplot(diff_eth[country != "UAE"], aes(date,V1,color=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth()
ggplot(diff_eth[country != "UAE"], aes(date,V1,color=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth() + theme(panel.margin = unit(5, "lines"))
library(grid)
library(scales)
ggplot(diff_eth[country != "UAE"], aes(date,V1,color=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth() + theme(panel.margin = unit(5, "lines"))
ggplot(diff_eth[country != "UAE"], aes(date,V1,color=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth() + theme(panel.margin = unit(2, "lines"))
ggplot(diff_eth[country != "UAE"], aes(date,V1,color=type,fill=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth() + theme(panel.margin = unit(2, "lines"))
ggplot(diff_eth[country != "UAE"], aes(date,V1,color=type,fill=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth() + theme(panel.margin = unit(2, "lines"))
nat_v_eth <- eta_res[category %in% c("Ethnic Groups","Nationalities") ]
diff_eth <- nat_v_eth[,.SD[category=="Nationalities"]$value-.SD[category=="Ethnic Groups"]$value,by=c("type","country","date")]
ggplot(diff_eth[country != "UAE"&type=="NEWS"], aes(date,V1,color=country)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth()
ggplot(diff_eth[country != "UAE"], aes(date,V1,color=type,fill=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth() + theme(panel.margin = unit(2, "lines"))
nat_v_eth <- eta_res[category %in% c("Ethnic Groups","Nationalities") & country %in% c("Egypt","Libya","Syria","Yemen","Bahrain","Iraq")]
diff_eth <- nat_v_eth[,.SD[category=="Nationalities"]$value-.SD[category=="Ethnic Groups"]$value,by=c("type","country","date")]
ggplot(diff_eth[country != "UAE"&type=="NEWS"], aes(date,V1,color=country)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth()
ggplot(diff_eth, aes(date,V1,color=type,fill=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth() + theme(panel.margin = unit(2, "lines"))
nat_v_eth <- eta_res[category %in% c("Ethnic Groups","Nationalities") & country %in% c("Egypt","Libya","Syria","Yemen","Bahrain","Tunisia","Iraq")]
diff_eth <- nat_v_eth[,.SD[category=="Nationalities"]$value-.SD[category=="Ethnic Groups"]$value,by=c("type","country","date")]
ggplot(diff_eth, aes(date,V1,color=type,fill=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth() + theme(panel.margin = unit(2, "lines"))
ggplot(diff_eth, aes(date,V1,color=type,fill=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth()
ggplot(eta_res[category %in% c("Protest","Violence") & type=="NEWS"], aes(date,color=category, fill=category)) + geom_point() + geom_smooth() + facet_wrap(~country)
ggplot(eta_res[category %in% c("Protest","Violence") & type=="NEWS"], aes(date,value,color=category, fill=category)) + geom_point() + geom_smooth() + facet_wrap(~country)
ggplot(eta_res[category %in% c("Protest","Violence") & type=="TWITTER"], aes(date,value,color=category, fill=category)) + geom_point() + geom_smooth() + facet_wrap(~country)
ggplot(eta_res[category %in% c("Adaptation","Violence") & type=="TWITTER"], aes(date,value,color=category, fill=category)) + geom_point() + geom_smooth() + facet_wrap(~country)
ggplot(eta_res[category %in% c("War","Violence") & type=="TWITTER"], aes(date,value,color=category, fill=category)) + geom_point() + geom_smooth() + facet_wrap(~country)
ggplot(eta_res[category %in% c("War","Violence","Protest") & type=="TWITTER"], aes(date,value,color=category, fill=category)) + geom_point() + geom_smooth() + facet_wrap(~country)
ggplot(eta_res[category %in% c("War","Violence","Protest") & type=="NEWS"], aes(date,value,color=category, fill=category)) + geom_point() + geom_smooth() + facet_wrap(~country)
eta_res
write.csv(eta_res, "eta_res.csv")
library(boot)
f <- function(d, i){
return(cor(d[i,]$TWITTER, d[i,]$NEWS))
}
boot_approx <- function(data,times_to_run=10000){
boot_out <- boot(data, f, R=times_to_run)
return(c(boot_out$t0,boot.ci(boot_out,type="basic",conf=.99)$basic[4:5]))
}
eta_res[category=="Protests"]
eta_res[category=="Protest"]
eta_res[category=="Protest",boot_approx(.SD),by="country"]
eta_res[category=="Protest",nrow(.SD),by="country"]
eta_res[category=="Protest",.SD,by="country"]
lv
lv[category=="Protest",.SD,by="country"]
lv[category=="Protest",boot_approx(.SD),by="country"]
ggplot(eta_res[category %in% c("War","Violence","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point() + geom_smooth() + facet_wrap(~type)
ggplot(eta_res[category %in% c("War","Violence","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point() + geom_smooth() + facet_wrap(~type) + geom_hline(y=0)+ geom_vline(x=as.numeric(ymd("2011-08-01"))  + geom_vline(x=as.numeric(ymd("2012-10-01")) + ylim(-2,1.5)
ggplot(eta_res[category %in% c("War","Violence","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point() + geom_smooth() + facet_wrap(~type) + geom_hline(y=0)+ geom_vline(x=as.numeric(ymd("2011-08-01"))  + geom_vline(x=as.numeric(ymd("2012-10-01"))
ggplot(eta_res[category %in% c("War","Violence","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point() + geom_smooth() + facet_wrap(~type) + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01"))  + geom_vline(x=as.numeric(ymd("2012-10-01"))
)
)
ggplot(eta_res[category %in% c("War","Violence","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point() + geom_smooth() + facet_wrap(~type) + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01"))  + geom_vline(x=as.numeric(ymd("2012-10-01"))
ggplot(eta_res[category %in% c("War","Violence","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point() + geom_smooth() + facet_wrap(~type)
ggplot(eta_res[category %in% c("War","Violence","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point() + geom_smooth() + facet_wrap(~type) + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01")))
ggplot(eta_res[category %in% c("War","Violence","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point() + geom_smooth(size=3) + facet_wrap(~type) + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01")))
ggplot(eta_res[category %in% c("War","Violence","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point() + geom_smooth(size=3,alpha=.4) + facet_wrap(~type) + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01")))
ggplot(eta_res[category %in% c("War","Violence","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point() + geom_smooth(size=3,alpha=.3) + facet_wrap(~type) + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01")))
ggplot(eta_res[category %in% c("War","Violence","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~type) + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01")))
ggplot(eta_res[category %in% c("War","Violence","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~type) + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom")
ggplot(eta_res[category %in% c("War","Violence","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~type) + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")
ggplot(eta_res[category %in% c("War","Violence","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~type,scales="free_y") + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")
ggplot(eta_res[category %in% c("War","Violence","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~type,scales="free_y") + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")  + ylab(expression(eta))
ggplot(eta_res[category %in% c("War","Violence","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~type,scales="free_y") + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")  + ylab(expression(eta[wrt]))
ggplot(eta_res[category %in% c("War","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~type,scales="free_y") + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")  + ylab(expression(eta[wrt]))
ggplot(eta_res[category %in% c("War","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~type,scales="free_y") + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")  + ylab(expression(eta[wrt])) + guides(fill=guide_legend(title="Theme"))
ggplot(eta_res[category %in% c("War","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~type,scales="free_y") + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")  + ylab(expression(eta[wrt])) + guides(color=guide_legend(title="Theme"))
ggplot(eta_res[category %in% c("War","Protest") & country=="Libya"], aes(date,value,color=category, fill=category)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~type,scales="free_y") + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")  + ylab(expression(eta[wrt])) + scale_colour_discrete("Theme")
ggplot(eta_res[category %in% c("War","Protest") & country=="Libya"], aes(date,value,color=category)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3,fill=category) + facet_wrap(~type,scales="free_y") + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")  + ylab(expression(eta[wrt])) + scale_colour_discrete("Theme")
ggplot(eta_res[category %in% c("War","Protest") & country=="Libya"], aes(date,value,color=category)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3,aes(fill=category)) + facet_wrap(~type,scales="free_y") + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")  + ylab(expression(eta[wrt])) + scale_colour_discrete("Theme")
ggplot(eta_res[category %in% c("War","Protest") & country=="Libya"], aes(date,value,color=category)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~type,scales="free_y") + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")  + ylab(expression(eta[wrt])) + scale_colour_discrete("Theme")
p_lib <- ggplot(eta_res[category %in% c("War","Protest") & country=="Libya"], aes(date,value,color=category)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~type,scales="free_y") + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")  + ylab(expression(eta[wrt])) + scale_colour_discrete("Theme")
ggsave("../arab_spring_paper/imgs/lib_protest_viol.pdf",w=8,h=4)
ggsave("../arab_spring_paper/imgs/lib_protest_viol.pdf",w=8,h=6)
ggsave("../arab_spring_paper/imgs/lib_protest_viol.pdf",w=8,h=5)
ggplot(eta_res[category %in% c("War","Protest") & country=="Tunisia"], aes(date,value,color=category)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~type,scales="free_y") + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")  + ylab(expression(eta[wrt])) + scale_colour_discrete("Theme")
source('~/git/minerva_relig_paper/R/final_analysis.R')
d2
p4 <- ggplot(d2, aes(reorder(corr_cat,-V1),V1, ymin=V2,ymax=V3,color=corr_cat!="All Stopword Categories" )) + geom_pointrange(size=1.5) + coord_flip() + geom_hline(y=0,color='red') + ylab("Correlation") + xlab("Category") + theme(legend.position="none")
p4
p4 <- ggplot(d2, aes(reorder(corr_cat,-V1),V1, ymin=V2,ymax=V3,color=corr_cat!="All Stopword Categories" )) + geom_pointrange(size=1) + coord_flip() + geom_hline(y=0,color='red') + ylab("Correlation") + xlab("Category") + theme(legend.position="none")
p4
ggsave("../arab_spring_paper/imgs/cat_corr.pdf",p4,width=8,height=3.5)
ggsave("../arab_spring_paper/imgs/cat_corr.pdf",p4,width=8,height=4.5)
d <- lv[cat_is_stop==F,as.list(boot_approx(.SD)),by="country"]
Q
d <- lv[cat_is_stop==F,as.list(boot_approx(.SD)),by="country"]
p5 <- ggplot(d, aes(reorder(country,-V1),V1, ymin=V2,ymax=V3 )) + geom_pointrange(size=1) + coord_flip() + geom_hline(y=0,color='red') + ylab("Correlation") + xlab("Country")
ggsave("../arab_spring_paper/imgs/country_corr.pdf",p5,width=8,height=4.5)
xtable <- function(x, ...) {
for (i in which(sapply(x, function(y) !all(is.na(match(c("POSIXt","Date"),class(y))))))) x[[i]] <- as.character(x[[i]])
xtable::xtable(x, ...)
}
xtable(arrange(lagged_vals[!category %in% c("Stopwords 1","Stopwords 2","Stopwords 3")],-abs(value)/sigma)[1:10])
by_cat <- eta_res[!(category %in% c("Stopwords 1","Stopwords 2","Stopwords 3")),mean(value),by=c("type","country","category")]
by_date <- eta_res[!(category %in% c("Stopwords 1","Stopwords 2","Stopwords 3")),mean(value),by=c("type","date","category")]
theme_set(theme_bw(22))
p1 <- ggplot(by_cat[type=="NEWS"],
aes(country,category,fill=V1))
p1 <- p1 + geom_tile() + facet_wrap(~type)
p1 <- p1 + theme(axis.text.x=element_text(angle=45,hjust=1))
p1 <- p1 + ylab("") + xlab("")
p1 <- p1 + guides(fill=guide_colourbar(title=expression(bar(eta[wrt]))))
p1 <- p1 + scale_fill_gradientn(
colours=c("red","white","steelblue"),
rescaler = function(x, ...) x,values=c(min(by_cat[type=="NEWS"]$V1-.1)
,0,max(by_cat[type=="NEWS"]$V1)+.1),
oob = identity,name="value")
ggsave("../arab_spring_paper/imgs/activity_topics_news.pdf",p1,
width=8,height=5.5)
ggsave("../arab_spring_paper/imgs/activity_topics_twitter.pdf",
p1 %+% by_cat[type=="TWITTER" ] +
scale_fill_gradientn(colours=c("red","white","steelblue"),
rescaler = function(x, ...) x,
values=c(min(by_cat[type=="TWITTER"]$V1-.1),
0,max(by_cat[type=="TWITTER"]$V1)+.1),
oob = identity,name="value"),
width=8,height=5.5)
p_lib <- ggplot(eta_res[category %in% c("Protest") & country%in% c("Libya","Bahrain","Tunisia","Yemen","Syria","Egypt")], aes(date,value,color=category)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~type,scales="free_y") + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")  + ylab(expression(eta[wrt])) + scale_colour_discrete("Theme")
p_lib
p_lib <- ggplot(eta_res[category %in% c("Protest") & country%in% c("Libya","Bahrain","Tunisia","Yemen","Syria","Egypt")], aes(date,value,color=country)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~type,scales="free_y") + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")  + ylab(expression(eta[wrt])) + scale_colour_discrete("Theme")
p_lib
ggplot(eta_res[category %in% c("Protest") & country%in% c("Libya","Bahrain","Tunisia","Yemen","Syria","Egypt")], aes(date,value,color=country)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~type,scales="free_y") + geom_hline(y=0) + geom_vline(x=as.numeric(ymd("2011-08-01")))  + geom_vline(x=as.numeric(ymd("2012-10-01"))) + theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")  + ylab(expression(eta[wrt])) + scale_colour_discrete("Theme")
ggplot(eta_res[category %in% c("Protest") & country%in% c("Libya","Bahrain","Tunisia","Yemen","Syria","Egypt")], aes(date,value,color=type)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~country,scales="free_y") + geom_hline(y=0) +  theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="3 months")  + ylab(expression(eta[wrt])) + scale_colour_discrete("Theme")
ggplot(eta_res[category %in% c("Protest") & country%in% c("Libya","Bahrain","Tunisia","Yemen","Syria","Egypt")], aes(date,value,color=type)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~country,scales="free_y") + geom_hline(y=0) +  theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="6 months")  + ylab(expression(eta[wrt])) + scale_colour_discrete("Theme")
ggsave("../arab_spring_paper/imgs/cottle.pdf",p2,width=8,height=8)
matt_plot <-  ggplot(eta_res[category %in% c("Protest") & country%in% c("Libya","Bahrain","Tunisia","Yemen","Syria","Egypt")], aes(date,value,color=type)) + geom_point(size=3) + geom_smooth(size=3,alpha=.3) + facet_wrap(~country,scales="free_y") + geom_hline(y=0) +  theme(axis.text.x=element_text(angle=45,hjust=1),legend.position="bottom") + scale_x_datetime(breaks="6 months")  + ylab(expression(eta[wrt])) + scale_colour_discrete("Theme")
ggsave("../arab_spring_paper/imgs/cottle.pdf",matt_plot,width=8,height=8)
ggsave("../arab_spring_paper/imgs/cottle.pdf",matt_plot,width=8,height=7)
nat_v_eth <- eta_res[category %in% c("Ethnic Groups","Nationalities") & country %in% c("Egypt","Libya","Syria","Yemen","Bahrain","Tunisia","Iraq")]
diff_eth <- nat_v_eth[,.SD[category=="Nationalities"]$value-.SD[category=="Ethnic Groups"]$value,by=c("type","country","date")]
ggplot(diff_eth, aes(date,V1,color=type,fill=type)) + geom_line() + geom_point() + geom_hline(y=0) + facet_wrap(~country) + theme(axis.text.x=element_text(angle=45,hjust=1)) + geom_smooth()
source('~/git/minerva_relig_paper/R/final_analysis.R')
